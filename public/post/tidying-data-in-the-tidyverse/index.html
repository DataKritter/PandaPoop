<!DOCTYPE html>
<html lang="en-us">

<head><style>
body {
	display: block;
	--colorBG: "#40e0d0, #ff8c00, #ff0080";background: linear-gradient(to right, var(--colorBG)) !important;
	
}

body, body.pushable {
	background-repeat: no-repeat;
  	background-attachment: fixed;
  	background-size: cover !important;
}

.ui.red.label, .ui.red.labels .label {
    background-color: #a333c8!important;
    border-color: #a333c8!important;
    color: #fff!important;
}


</style><title>
Tidying data in the tidyverse
</title><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="author" content="Heidi" />
	<meta name="description" content="Cleaning up messy data" />
<meta name="generator" content="Hugo 0.47.1" />

<link rel="shortcut icon" href="/img/favicon.gif">

<link rel="canonical" href="/post/tidying-data-in-the-tidyverse/" />
<link rel="alternative" href="/index.xml" title="Panda Poop" type="application/atom+xml"/>
<link rel="stylesheet" href="/css/atelier-cave-light.css" rel="stylesheet" id="theme-stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css">
<style>
body.pushable {
	display: block;background: linear-gradient(to right, var(--colorBG)) !important;
	 ;
}
</style>
<link rel="stylesheet" type="text/css" href="/css/site.css"><link rel="stylesheet" type="text/css" href="static/css/highlight.css">
<script>
	var colorBG =  true 
	var enabledPost = true
	var isMobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
	console.log("The client device is a "+(isMobile?"mobile":"PC")+".")
</script>
</head>

<body><script>
var prevBgIndex = 0;
var bodyBgSwitchIndex = 0;var gradients = [
	  ['#726C84', '#908AA1'], 
	  ['#726C84', '#A79EB6'], 
	  ['#726C84', '#736E86'], 
	  ['#726C84', '#5E5A76'] 
	]
	document.body.style.setProperty('--colorBG', connect(gradients[getRandomInt(0, gradients.length)]))
	function getRandomInt(min, max) {
	  min = Math.ceil(min)
	  max = Math.floor(max)
	  var random
	  while (1) {
	    random = Math.floor(Math.random() * (max - min)) + min
	    if (random !== prevBgIndex) {
	      prevBgIndex = random
	      break
	    }
	  }
	  return random
	}

	function connect(arr) {
	  var str = ''
	  for (var i = 0; i < arr.length; i++) {
	    if (i !== arr.length - 1) {
	      str += arr[i] + ', '
	    } else {
	      str += arr[i]
	    }
	  }
	  return str
	}
</script><div id="sidebar" class="ui sidebar inverted vertical menu">
	<section id="author" class="ui top attached center aligned inverted segment"><div class="ui small circular image">
	<img src="/img/heidielephant.png">
</div>
<h3 class="ui header">Panda Poop
	<div class="sub header">Improving animal health through data science</div>
</h3>
</section><section class="ui attached center aligned inverted segment sidebar-dream-tags">
<a class="ui label" href="/tags/energy" title="energy">energy</a>

<a class="ui label" href="/tags/gganimate" title="gganimate">gganimate</a>

<a class="ui label" href="/tags/ggplot2" title="ggplot2">ggplot2</a>

<a class="ui label" href="/tags/hunger" title="hunger">hunger</a>

<a class="ui label" href="/tags/maps" title="maps">maps</a>

<a class="ui label" href="/tags/reproducible_research" title="reproducible_research">reproducible_research</a>

<a class="ui label" href="/tags/shiny" title="shiny">shiny</a>

<a class="ui label" href="/tags/test" title="test">test</a>

<a class="ui label" href="/tags/tidy_data" title="tidy_data">tidy_data</a>

</section>	
	
	<section class="ui attached inverted segment sidebar-dream-categories both flexbox">
		<div class="ui inverted accordion">
<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/nutrition">nutrition</a>
</div>
<div class="content">

	<a class="item" href="/post/managing-hunger/">
		<div>
			<i class="dot circle icon "></i>
			<p>Feeding &#34;hungry&#34; animals</p>
		</div>
	</a>

</div>

<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/r">r</a>
</div>
<div class="content">

	<a class="item" href="/post/moving-to-the-cloud-installing-rstudio-server-on-digital-ocean/">
		<div>
			<i class="dot circle icon "></i>
			<p>Moving to the Cloud: Installing RStudio Server on Digital Ocean</p>
		</div>
	</a>

	<a class="item" href="/post/mapping-bee-colonies-in-florida-with-ggplot2/">
		<div>
			<i class="dot circle icon "></i>
			<p>Mapping bee colonies in Florida with ggplot2</p>
		</div>
	</a>

	<a class="item" href="/post/reproducible-research/">
		<div>
			<i class="dot circle icon "></i>
			<p>Reproducible Research</p>
		</div>
	</a>

	<a class="item" href="/post/basic-shiny-example-a-survey-using-filters/">
		<div>
			<i class="dot circle icon "></i>
			<p>Basic Shiny Example: A survey using filters</p>
		</div>
	</a>

	<a class="item" href="/post/tidying-data-in-the-tidyverse/">
		<div>
			<i class="dot circle icon "></i>
			<p>Tidying data in the tidyverse</p>
		</div>
	</a>

	<a class="item" href="/post/playing-with-gganimate/">
		<div>
			<i class="dot circle icon "></i>
			<p>Playing with gganimate</p>
		</div>
	</a>

	<a class="item" href="/post/testing-r-markdown/">
		<div>
			<i class="dot circle icon "></i>
			<p>Testing R Markdown</p>
		</div>
	</a>

</div>

</div>
	</section>
	
	
	<section id="footer" class="ui bottom attached center aligned inverted segment">
<p>Â© 2019 Panda Poop</p>
    
<p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus</a> theme.</p></section>
</div>
<div class="pusher">
		<div class="flipper">
			<div class="front">
<nav class="ui top secondary menu bar">
	<div class="item">
		<i class="inverted big link user icon dream-flip-toggle" title="About Me"></i>
	</div><div class="item">
		<a href="/">
			<i class="inverted big link home icon" title="Home"></i>
		</a>
	</div>
	<div class="item">
		<a href="/post">
			<i class="inverted big link tree icon" title="Archive"></i>
		</a>
	</div>
	<div class="item">
		<a href="/tags">
			<i class="inverted big link tags icon" title="All Tags"></i>
		</a>
	</div>
	<div class="item">
		<a href="/categories">
			<i class="inverted big link folder icon" title="All Categories"></i>
		</a>
    </div>
	<div class="ui container tablet computer only grid">
		<div class="item" onClick="$('.ui.sidebar').sidebar('setting', 'transition', 'overlay').sidebar('toggle');">
			<i class="inverted big link sidebar icon" title="Show Sidebar"></i>
		</div>
	</div>
	
</nav>

<div class="ui centered grid">
	<div class="sixteen wide mobile only column"><div class="ui inverted accordion">
	<div id="header" class="ui inverted segment column box">
		<header id="author" class="ui top attached center aligned inverted segment"><div class="ui small circular image">
	<img src="/img/heidielephant.png">
</div>
<h3 class="ui header">Panda Poop
	<div class="sub header">Improving animal health through data science</div>
</h3>
</header>
		<div class=" title header-title"><div id="tag-category-pop" class="ui red right corner label">
				<i class="hand point icon down"title="Click this to pop tags and categories"></i>
			</div></div>
		<div id="tag-category" class=" content"><section class="ui attached center aligned inverted segment dream-tags none flexbox">
<a class="ui label" href="/tags/energy" title="energy">energy</a>

<a class="ui label" href="/tags/gganimate" title="gganimate">gganimate</a>

<a class="ui label" href="/tags/ggplot2" title="ggplot2">ggplot2</a>

<a class="ui label" href="/tags/hunger" title="hunger">hunger</a>

<a class="ui label" href="/tags/maps" title="maps">maps</a>

<a class="ui label" href="/tags/reproducible_research" title="reproducible_research">reproducible_research</a>

<a class="ui label" href="/tags/shiny" title="shiny">shiny</a>

<a class="ui label" href="/tags/test" title="test">test</a>

<a class="ui label" href="/tags/tidy_data" title="tidy_data">tidy_data</a>

</section><section class="ui attached inverted segment dream-categories both flexbox">
			<div class="inverted accordion">
<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/nutrition">nutrition</a>
</div>
<div class="content">

	<a class="item" href="/post/managing-hunger/">
		<div>
			<i class="dot circle icon "></i>
			<p>Feeding &#34;hungry&#34; animals</p>
		</div>
	</a>

</div>

<div class="title">
	<i class="dropdown icon"></i>
	<a class="link" href="/categories/r">r</a>
</div>
<div class="content">

	<a class="item" href="/post/moving-to-the-cloud-installing-rstudio-server-on-digital-ocean/">
		<div>
			<i class="dot circle icon "></i>
			<p>Moving to the Cloud: Installing RStudio Server on Digital Ocean</p>
		</div>
	</a>

	<a class="item" href="/post/mapping-bee-colonies-in-florida-with-ggplot2/">
		<div>
			<i class="dot circle icon "></i>
			<p>Mapping bee colonies in Florida with ggplot2</p>
		</div>
	</a>

	<a class="item" href="/post/reproducible-research/">
		<div>
			<i class="dot circle icon "></i>
			<p>Reproducible Research</p>
		</div>
	</a>

	<a class="item" href="/post/basic-shiny-example-a-survey-using-filters/">
		<div>
			<i class="dot circle icon "></i>
			<p>Basic Shiny Example: A survey using filters</p>
		</div>
	</a>

	<a class="item" href="/post/tidying-data-in-the-tidyverse/">
		<div>
			<i class="dot circle icon "></i>
			<p>Tidying data in the tidyverse</p>
		</div>
	</a>

	<a class="item" href="/post/playing-with-gganimate/">
		<div>
			<i class="dot circle icon "></i>
			<p>Playing with gganimate</p>
		</div>
	</a>

	<a class="item" href="/post/testing-r-markdown/">
		<div>
			<i class="dot circle icon "></i>
			<p>Testing R Markdown</p>
		</div>
	</a>

</div>

</div>
			</section></div>
		<footer class="ui bottom attached center aligned inverted segment">
<p>Â© 2019 Panda Poop</p>
    
<p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with <a href="https://github.com/UtkarshVerma/hugo-dream-plus" target="_blank">Dream Plus</a> theme.</p></footer>
	</div>
</div></div>
	<div class="sixteen wide mobile fifteen wide tablet twelve wide computer column post-list">
		<section class="ui secondary top attached black segment post-head">
			<h1 class="post-title">
				Tidying data in the tidyverse
			</h1>
			<div class="sub header">
					<div><span><i class="calendar outline icon"></i>8 Sep 2018</span></div>
					<div><span><i class="clock outline icon"></i>3 min read</span></div>
					
			</div>
			<hr>
			
			<article class="post-content twemoji">
				<p>This is an example of a messy dataset I might receive that needs tidying. Interns measured the length and dorsal girth (measurement around the middle) of several fish over time. Each time they measured the fish, they added a few more lines to the excel sheet for that date. This made data entry very convenient, but isnât a usable format for data analysis.</p>
<div class="figure">
<img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/messydata.gif" alt="Fig 1. Messy Data" />
<p class="caption"><em>Fig 1. Messy Data</em></p>
</div>
<p>Itâs not a problem, though, because we have the Tidyverse!</p>
<p>Our goal is to produce a tidy dataset that we can use. Perhaps we want to graph the growth of the fish over time. Or maybe we want to see if the fish differ in their len:girth ratio in some way. Perhaps we want to see whether there are seasonal changes in size. Look at those variables I just mentioned. Fish, Time, Length, Girth, L:G ratio, Season. Those are things we want to be columns.</p>
<p>So, our goal is to tidy the data by: - making a new column for FishID (instead of the 4 columns there now) - spreading the column for measurement into separate columns for length and girth - cleaning up missing data</p>
<div class="figure">
<img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/tidydata.gif" alt="Fig 2. Tidy Data" />
<p class="caption"><em>Fig 2. Tidy Data</em></p>
</div>
<p>So, first we start by loading some basic packages to get going.</p>
<pre class="r"><code>library(readxl)
library(tidyverse)
#Read in our mock raw data file
Morphs &lt;- read_xlsx(&quot;../attachments/FishMorphometrics.xlsx&quot;, 
    col_types = c(&quot;date&quot;, &quot;text&quot;, &quot;numeric&quot;,&quot;numeric&quot;, &quot;numeric&quot;, &quot;numeric&quot;), 
    na = &quot;NA&quot;)</code></pre>
<p>Now we are ready to tidy! This is what I came up with. Itâs a little cludgy, but it works, and it illustrates the Tidyverse grammar nicely (which is really the point here, after all).</p>
<pre class="r"><code>MorphTidy &lt;- Morphs %&gt;%
#Rename the date column because (1) I hate all caps and (2) `Date` is a reserved word that can sometimes be problematic if used as a variable name.  Best to rename it something like `TheDate` or `DateMeas`. 
  rename(MeasDate = DATE) %&gt;%

#Gather the fish into a single column
  gather(starts_with(&quot;Fish&quot;), key = FishID, value = Meas ) %&gt;%
      
#Add row numbers to avoid &quot;duplicate identifiers&quot; error.  Each row needs to have unique info, but in this case some of the fish/date lines have the same info.
  mutate(i = row_number()) %&gt;%
  spread(key = Measure, value = Meas) %&gt;%
      
#After spreading we don&#39;t need the identifier anymore.
  select(-i) %&gt;%

#The various measurements are now in different rows.  This code gets them to be in the same row and then removes any dates where fish weren&#39;t measured.
  arrange(FishID, MeasDate) %&gt;%
  group_by(FishID, MeasDate) %&gt;%
  summarize(len = mean(Length, na.rm = TRUE), 
            dg = mean(DG, na.rm = TRUE)) %&gt;%
  filter((len + dg) &gt; 0) %&gt;%
  mutate(len = ifelse(len == 0, NA, len), 
         dg = ifelse(dg == 0, NA, dg)) %&gt;%
  arrange(FishID, MeasDate)

#If desired, save the cleaned file for future work
#library(writexl)
#write_xlsx(MorphsTidy, &quot;morphstidy.xlsx&quot;)</code></pre>
<p>Now, if we want, we can graph it.</p>
<p>Looking at changes in length over timeâ¦</p>
<pre class="r"><code>ggplot(MorphTidy, aes(x = MeasDate, y = len, color = FishID)) + geom_point()</code></pre>
<p><img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Looking at changes in girth over timeâ¦</p>
<pre class="r"><code>ggplot(MorphTidy, aes(x = MeasDate, y = dg, color = FishID)) + geom_point()</code></pre>
<p><img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Looking at differences in length:girth ratioâ¦</p>
<pre class="r"><code>MorphTidy2 &lt;- MorphTidy %&gt;%
      mutate(lgr = len/dg)

ggplot(MorphTidy2, aes(x=FishID, y = lgr, color = FishID)) +
      geom_boxplot()</code></pre>
<p><img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Looking at seasonal changesâ¦</p>
<pre class="r"><code>library(lubridate)
MorphTidy3 &lt;- MorphTidy %&gt;%
      mutate(month = month(MeasDate, label = TRUE))

p &lt;- ggplot(MorphTidy3, aes(x = month, y = dg)) + geom_boxplot()

q &lt;- ggplot(MorphTidy3, aes(x = month, y = len)) + geom_boxplot()

library(gridExtra)
grid.arrange(p, q, ncol = 2)</code></pre>
<p><img src="/post/2018-09-08-tidying-data-in-the-tidyverse_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>

			</article>
		</section>
		<section class="ui secondary attached segment dream-tags">
<a class="ui label" href="/tags/energy" title="energy">energy</a>

<a class="ui label" href="/tags/gganimate" title="gganimate">gganimate</a>

<a class="ui label" href="/tags/ggplot2" title="ggplot2">ggplot2</a>

<a class="ui label" href="/tags/hunger" title="hunger">hunger</a>

<a class="ui label" href="/tags/maps" title="maps">maps</a>

<a class="ui label" href="/tags/reproducible_research" title="reproducible_research">reproducible_research</a>

<a class="ui label" href="/tags/shiny" title="shiny">shiny</a>

<a class="ui label" href="/tags/test" title="test">test</a>

<a class="ui label" href="/tags/tidy_data" title="tidy_data">tidy_data</a>


		</section><section class="ui secondary bottom attached segment share row box"><div class="author"><img class="avatar" src="/img/heidielephant.png">
	
</div>
<div class="info grow flexbox"><a href="https://twitter.com/pandapoop42">
	
	<p class="name">Panda Poop</p></a>
	
	<p class="desc">Improving animal health through data science</p>		
</div>
<section class="buttons row box">
	<div class="facebook none flexbox" href="#" onclick="window.open(
			'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
			'facebook-share-dialog',
			'width=626,height=436'); return false;">
		<button class="ui facebook button"><i class="facebook icon"></i>Share</button>
	</div>
	<div class="twitter none flexbox" onclick="window.open('https://twitter.com/intent/tweet?text=Read &quot;Tidying data in the tidyverse &quot; by @pandapoop42 \/post\/tidying-data-in-the-tidyverse\/','_self')">
		<button class="ui twitter button"><i class="twitter icon"></i>Tweet</button>
	</div>
</section>
</section>
		<section class="ui secondary attached segment copyright">
			
		</section>
		


	</div>
</div>

			</div>
			<div class="back"><nav class="ui top secondary menu bar">
	<div class="item">
		<i class="inverted big link chevron circle left icon icon dream-flip-toggle" title="About Me"></i>
	</div><div class="item">
	<a href="https://github.com/cricketbird" target="_blank">
		<i id="ico" class="inverted big link github icon" title="GitHub"></i>
	</a>
</div>
<div class="item">
	<a href="mailto:cricketbirdy@gmail.com">
		<i id="ico" class="inverted big link mail icon" title="Email"></i>
	</a>
</div>
<div class="item">
	<a href="https://twitter.com/pandapoop42" target="_blank">
		<i id="ico" class="inverted big link twitter icon" title="Twitter"></i>
	</a>
</div>
<div class="item">
	<a href="https://www.stackoverflow.com/users/cricketbird" target="_blank">
		<i id="ico" class="inverted big link stack overflow icon" title="Stack Overflow"></i>
	</a>
</div>

</nav>
<div class="ui centered grid about">
	<div class="sixteen wide mobile fifteen wide tablet fifteen wide computer column about">
		<section class="ui stacked segments"><div class="ui inverted segment">
	<article class="twemoji"><h1>So, Who Am I?</h1>

<hr />

<p><br>
Iâm a nutritional ecologist who likes making tools for my colleagues.  This blog is my place to keep tidbits of things I find useful and a way to collect my ideas for future projects.</p>

<p><img src="/./about_files/heididogfeed.png" alt="heidi and dog" /></p>
</article>
</div></section>
	</div>
</div></div>
		</div>
	</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/site.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script><script src="https://twemoji.maxcdn.com/2/twemoji.min.js?2.6"></script>
<script id="dsq-count-scr" src="//.disqus.com/count.js" async></script>

<script>
	(function () {
	  console.log("Twemoji up and making stuff colourful!");
	  for (var b = document.getElementsByClassName("twemoji"), a = 0; a < b.length; a++) {
		twemoji.parse(b[a]);
	  }
	})();
</script>

</body>

</html>